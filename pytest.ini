# Конфигурация pytest для проекта VideoTranslator

[pytest]
# Минимальная версия pytest
minversion = 8.0

# Директории для поиска тестов
testpaths = src/tests

# Паттерны файлов с тестами
python_files = test_*.py

# Паттерны классов с тестами
python_classes = Test*

# Паттерны функций-тестов
python_functions = test_*

# Маркеры для категоризации тестов
markers =
    asyncio: marks tests as async (using pytest-asyncio)
    unit: unit tests (no external dependencies)
    integration: integration tests (require RabbitMQ + worker)
    connection: connection tests (require RabbitMQ only)
    slow: marks tests as slow running

# Асинхронные тесты
asyncio_mode = auto
asyncio_default_fixture_loop_scope = function

# Опции вывода
addopts =
    # Verbose output
    -v
    # Show local variables in tracebacks
    -l
    # Show summary of all test outcomes
    -ra
    # Strict markers (fail on unknown markers)
    --strict-markers
    # Warnings as errors (опционально)
    # -W error
    # Disable cacheprovider
    -p no:cacheprovider

# Логирование во время тестов
log_cli = false
log_cli_level = INFO
log_cli_format = %(asctime)s [%(levelname)8s] %(name)s - %(message)s
log_cli_date_format = %Y-%m-%d %H:%M:%S

log_file = var/log/pytest.log
log_file_level = DEBUG
log_file_format = %(asctime)s [%(levelname)8s] %(name)s - %(message)s
log_file_date_format = %Y-%m-%d %H:%M:%S

# Игнорировать предупреждения
filterwarnings =
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning
    # Ignore specific warnings from libraries
    ignore:.*'audioop'.*:DeprecationWarning
    ignore:.*'chunk'.*:DeprecationWarning

# Coverage options (if pytest-cov is installed)
[coverage:run]
source = src
omit =
    src/tests/*
    src/__pycache__/*
    */__pycache__/*

[coverage:report]
precision = 2
show_missing = true
skip_covered = false

[coverage:html]
directory = htmlcov
