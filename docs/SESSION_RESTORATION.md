# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–∑ —Å–µ—Å—Å–∏–∏

## –û–ø–∏—Å–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ñ–æ—Ä–º—ã –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –∑–∞–∫—Ä—ã—Ç—å –±—Ä–∞—É–∑–µ—Ä –∏–ª–∏ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É, –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ñ–æ—Ä–º—ã –±—É–¥–µ—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –∏–∑ —Å–µ—Ä–≤–µ—Ä–Ω–æ–π —Å–µ—Å—Å–∏–∏.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è

### Backend (FastAPI)

#### –ù–æ–≤—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç: `GET /files/session/status`

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `src/routers/file_router.py`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–µ—Å—Å–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**–û—Ç–≤–µ—Ç:**
```json
{
  "pending": false,           // –ò–¥–µ—Ç –ª–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–∞
  "need_download": true,      // –ì–æ—Ç–æ–≤ –ª–∏ —Ñ–∞–π–ª –∫ —Å–∫–∞—á–∏–≤–∞–Ω–∏—é
  "file": {                   // –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å)
    "filename": "video.mp4",
    "size": 10485760,
    "upload_time": "2025-11-11T10:30:00Z"
  }
}
```

**–í–æ–∑–º–æ–∂–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è:**

1. **–û–±—ã—á–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ** (–Ω–µ—Ç —Ñ–∞–π–ª–∞):
   ```json
   {"pending": false, "need_download": false, "file": null}
   ```

2. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ**:
   ```json
   {"pending": true, "need_download": false, "file": null}
   ```

3. **–§–∞–π–ª –≥–æ—Ç–æ–≤ –∫ —Å–∫–∞—á–∏–≤–∞–Ω–∏—é**:
   ```json
   {
     "pending": false,
     "need_download": true,
     "file": {
       "filename": "video.mp4",
       "size": 10485760,
       "upload_time": "2025-11-11T10:30:00Z"
     }
   }
   ```

### Frontend (Stimulus Controllers)

#### FormController

**–§–∞–π–ª:** `public/js/controllers/formController.js`

**–ù–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã:**

1. **`restoreSessionState()`**
   - –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞
   - –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å —Å–µ—Å—Å–∏–∏ —á–µ—Ä–µ–∑ `fetch('/files/session/status')`
   - –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç UI –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø–æ–ª—É—á–µ–Ω–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è

2. **`restoreFileInfo(fileData)`**
   - –ü–µ—Ä–µ–¥–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª–∞ –≤ `fileController`
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `application.getControllerForElementAndIdentifier()` –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –¥—Ä—É–≥–æ–º—É –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—É

**–õ–æ–≥–∏–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è:**

```javascript
// –ï—Å–ª–∏ —Ñ–∞–π–ª –≥–æ—Ç–æ–≤ –∫ —Å–∫–∞—á–∏–≤–∞–Ω–∏—é
if (sessionData.need_download && sessionData.file) {
    this.hideSpinner();
    this.showForm();
    this.restoreFileInfo(sessionData.file);
    this.hideSubmitButton();
    this.showDownloadButton();
}

// –ï—Å–ª–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –µ—â–µ –∏–¥–µ—Ç
if (sessionData.pending) {
    this.showSpinner('–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–∞...');
}

// –û–±—ã—á–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
else {
    this.hideSpinner();
    this.showForm();
}
```

#### FileController

**–§–∞–π–ª:** `public/js/controllers/fileController.js`

**–ù–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã:**

1. **`restoreFromSession(fileData)`**
   - –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ñ–∞–π–ª–µ –≤ UI
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏–º—è —Ñ–∞–π–ª–∞, —Ä–∞–∑–º–µ—Ä –∏ –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏
   - –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –∏–∫–æ–Ω–∫—É
   - –ü–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç –≤–∏–¥–∏–º–æ—Å—Ç—å –¥—Ä–æ–ø–∑–æ–Ω—ã –∏ –±–ª–æ–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ñ–∞–π–ª–µ

2. **`updateFileIconByExtension(extension)`**
   - –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–∏–ø —Ñ–∞–π–ª–∞ –ø–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—é
   - –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é SVG-–∏–∫–æ–Ω–∫—É (–≤–∏–¥–µ–æ, –∞—É–¥–∏–æ, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ)
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–æ–≥–¥–∞ –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –æ–±—ä–µ–∫—Ç—É File

**–ü—Ä–∏–º–µ—Ä –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è:**

```javascript
restoreFromSession({
    filename: "video.mp4",
    size: 10485760,
    upload_time: "2025-11-11T10:30:00Z"
})
```

## –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–≥—Ä—É–∑–∏–ª —Ñ–∞–π–ª –∏ –∑–∞–∫—Ä—ã–ª –±—Ä–∞—É–∑–µ—Ä

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Ñ–∞–π–ª
2. –°–µ—Ä–≤–µ—Ä –Ω–∞—á–∏–Ω–∞–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `session['pending'] = True`
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –±—Ä–∞—É–∑–µ—Ä
4. –°–µ—Ä–≤–µ—Ä –∑–∞–≤–µ—Ä—à–∞–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç:
   - `session['pending'] = False`
   - `session['need_download'] = True`
5. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–Ω–æ–≤–∞ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É
6. `formController.connect()` ‚Üí `restoreSessionState()`
7. –ó–∞–ø—Ä–æ—Å –∫ `/files/session/status`
8. –§–æ—Ä–º–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–Ω–æ–ø–∫—É "–°–∫–∞—á–∞—Ç—å –≤–∏–¥–µ–æ"

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–±–Ω–æ–≤–∏–ª —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤–æ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏

1. –§–∞–π–ª –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ (`session['pending'] = True`)
2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É (F5)
3. `restoreSessionState()` –ø–æ–ª—É—á–∞–µ—Ç `{"pending": true}`
4. –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Å–ø–∏–Ω–Ω–µ—Ä "–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–∞..."
5. –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –µ—â–µ —Ä–∞–∑
6. –¢–æ–≥–¥–∞ –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—Å—è –∫–Ω–æ–ø–∫–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤–ø–µ—Ä–≤—ã–µ

1. –°–µ—Å—Å–∏—è –ø—É—Å—Ç–∞—è –∏–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
2. `restoreSessionState()` –ø–æ–ª—É—á–∞–µ—Ç `{"pending": false, "need_download": false, "file": null}`
3. –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –æ–±—ã—á–Ω–∞—è —Ñ–æ—Ä–º–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –í—Å–µ –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ —Å–µ—Ä–≤–µ—Ä–Ω–æ–π —Å–µ—Å—Å–∏–∏ (cookie-based)
- –§–∞–π–ª—ã –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ —Å–µ—Å—Å–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ù–µ—Ç –ø–µ—Ä–µ–¥–∞—á–∏ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—É—Ç–µ–π –∫–ª–∏–µ–Ω—Ç—É

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- –ó–∞–ø—Ä–æ—Å `/files/session/status` –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- –ù–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ UI
- –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –æ–±—ã—á–Ω–∞—è —Ñ–æ—Ä–º–∞

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

```javascript
try {
    const response = await fetch('/files/session/status');
    // ...–æ–±—Ä–∞–±–æ—Ç–∫–∞
} catch (error) {
    console.error('–û—à–∏–±–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å–µ—Å—Å–∏–∏:', error);
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–±—ã—á–Ω—É—é —Ñ–æ—Ä–º—É
    this.hideSpinner();
    this.showForm();
}
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä: `python -m src.app`
2. –û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä: `http://localhost:8000`
3. –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª
4. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É (F5)
5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ curl –∏–ª–∏ Postman:

```bash
curl -X GET http://localhost:8000/files/session/status -H "Cookie: session=..."
```

### DevTools Console

–û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:
- `üîÑ FormController.restoreSessionState - –Ω–∞—á–∞–ª–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è`
- `üì¶ Session data: {...}`
- `‚úÖ –§–∞–π–ª –≥–æ—Ç–æ–≤ –∫ —Å–∫–∞—á–∏–≤–∞–Ω–∏—é`

## –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. **–ù–µ—Ç –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è**: –ï—Å–ª–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –µ—â–µ –∏–¥–µ—Ç, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –≤—Ä—É—á–Ω—É—é –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É
   - **–†–µ—à–µ–Ω–∏–µ**: –í –±—É–¥—É—â–µ–º –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å WebSocket/SSE –¥–ª—è real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

2. **–í—Ä–µ–º—è –∂–∏–∑–Ω–∏ —Å–µ—Å—Å–∏–∏**: –°–µ—Å—Å–∏—è –∏—Å—Ç–µ–∫–∞–µ—Ç —á–µ—Ä–µ–∑ 12 —á–∞—Å–æ–≤ (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –≤ `CustomSessionStore`)

3. **–ü—Ä–µ–≤—å—é —Ñ–∞–π–ª–∞**: –ü—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∏–∫–æ–Ω–∫–∞, –Ω–µ –ø—Ä–µ–≤—å—é –≤–∏–¥–µ–æ
   - **–ü—Ä–∏—á–∏–Ω–∞**: –ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –æ–±—ä–µ–∫—Ç—É File, —Ç–æ–ª—å–∫–æ –∫ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º

## –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

1. **WebSocket/SSE –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
2. **–ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä**: –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ–Ω—Ç–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏
3. **–ò—Å—Ç–æ—Ä–∏—è —Ñ–∞–π–ª–æ–≤**: –°–ø–∏—Å–æ–∫ —Ä–∞–Ω–µ–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
4. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**: Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏
